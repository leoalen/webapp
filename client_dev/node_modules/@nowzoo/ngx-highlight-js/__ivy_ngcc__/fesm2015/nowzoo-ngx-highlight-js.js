import { InjectionToken, Injectable, Inject, Component, Input, NgModule, defineInjectable, inject } from '@angular/core';
import { Sheetload, Scriptload } from '@nowzoo/sheetload';
import { HttpClient, HttpClientModule } from '@angular/common/http';
import { CommonModule } from '@angular/common';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common/http';
import * as ɵngcc2 from '@angular/common';
const /** @type {?} */ NGX_HIGHLIGHT_JS_URL = new InjectionToken('The base url for highlight.js');
const /** @type {?} */ NGX_HIGHLIGHT_JS_DEFAULT_THEME = new InjectionToken('The default theme for highlight.js');

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
class NgxHighlightJsThemeService {
    /**
     * @param {?} _defaultTheme
     * @param {?} _jsURL
     */
    constructor(_defaultTheme, _jsURL) {
        this._defaultTheme = _defaultTheme;
        this._jsURL = _jsURL;
        this._theme = 'default';
        this._initializedPromise = null;
        this._linkEl = null;
        this._theme = _defaultTheme;
    }
    /**
     * @return {?}
     */
    initialized() {
        if (!this._initializedPromise) {
            this._initializedPromise = this.loadTheme(this._theme);
        }
        return this._initializedPromise;
    }
    /**
     * @param {?} name
     * @return {?}
     */
    loadTheme(name) {
        const /** @type {?} */ url = `${this._jsURL}/styles/${name}.min.css`;
        return Sheetload.load(url)
            .then((linkEl) => {
            if (this._linkEl) {
                this._linkEl.remove();
            }
            this._linkEl = linkEl;
            this._linkEl.removeAttribute('disabled');
        });
    }
    /**
     * @return {?}
     */
    get theme() {
        return this._theme;
    }
}
NgxHighlightJsThemeService.ɵfac = function NgxHighlightJsThemeService_Factory(t) { return new (t || NgxHighlightJsThemeService)(ɵngcc0.ɵɵinject(NGX_HIGHLIGHT_JS_DEFAULT_THEME), ɵngcc0.ɵɵinject(NGX_HIGHLIGHT_JS_URL)); };
NgxHighlightJsThemeService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NgxHighlightJsThemeService, factory: NgxHighlightJsThemeService.ɵfac, providedIn: 'root' });
/** @nocollapse */
NgxHighlightJsThemeService.ctorParameters = () => [
    { type: String, decorators: [{ type: Inject, args: [NGX_HIGHLIGHT_JS_DEFAULT_THEME,] }] },
    { type: String, decorators: [{ type: Inject, args: [NGX_HIGHLIGHT_JS_URL,] }] }
];
/** @nocollapse */ NgxHighlightJsThemeService.ngInjectableDef = defineInjectable({ factory: function NgxHighlightJsThemeService_Factory() { return new NgxHighlightJsThemeService(inject(NGX_HIGHLIGHT_JS_DEFAULT_THEME), inject(NGX_HIGHLIGHT_JS_URL)); }, token: NgxHighlightJsThemeService, providedIn: "root" });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NgxHighlightJsThemeService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: String, decorators: [{
                type: Inject,
                args: [NGX_HIGHLIGHT_JS_DEFAULT_THEME]
            }] }, { type: String, decorators: [{
                type: Inject,
                args: [NGX_HIGHLIGHT_JS_URL]
            }] }]; }, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
class NgxHighlightJsScriptService {
    /**
     * @param {?} _jsURL
     */
    constructor(_jsURL) {
        this._jsURL = _jsURL;
        this._hljs = null;
        this._loadedLanguages = new Map();
    }
    /**
     * @return {?}
     */
    loaded() {
        if (this._loadedPromise) {
            return this._loadedPromise;
        }
        this._loadedPromise = new Promise((resolve, reject) => {
            const /** @type {?} */ url = `${this._jsURL}/highlight.min.js`;
            Scriptload.load(url)
                .then(() => {
                setTimeout(() => {
                    this._hljs = window['hljs'];
                    resolve(this._hljs);
                }, 10);
            })
                .catch(reject);
        });
        return this._loadedPromise;
    }
    /**
     * @param {?} lang
     * @return {?}
     */
    loadLanguage(lang) {
        let /** @type {?} */ p = this._loadedLanguages.get(lang);
        if (p) {
            return p;
        }
        if (this._hljs && this._hljs.listLanguages().indexOf(lang) > -1) {
            p = Promise.resolve();
            this._loadedLanguages.set(lang, p);
            return p;
        }
        const /** @type {?} */ url = `${this._jsURL}/languages/${lang}.min.js`;
        p = this.loaded()
            .then(() => {
            return Scriptload.load(url);
        });
        this._loadedLanguages.set(lang, p);
        return p;
    }
}
NgxHighlightJsScriptService.ɵfac = function NgxHighlightJsScriptService_Factory(t) { return new (t || NgxHighlightJsScriptService)(ɵngcc0.ɵɵinject(NGX_HIGHLIGHT_JS_URL)); };
NgxHighlightJsScriptService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NgxHighlightJsScriptService, factory: NgxHighlightJsScriptService.ɵfac, providedIn: 'root' });
/** @nocollapse */
NgxHighlightJsScriptService.ctorParameters = () => [
    { type: String, decorators: [{ type: Inject, args: [NGX_HIGHLIGHT_JS_URL,] }] }
];
/** @nocollapse */ NgxHighlightJsScriptService.ngInjectableDef = defineInjectable({ factory: function NgxHighlightJsScriptService_Factory() { return new NgxHighlightJsScriptService(inject(NGX_HIGHLIGHT_JS_URL)); }, token: NgxHighlightJsScriptService, providedIn: "root" });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NgxHighlightJsScriptService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: String, decorators: [{
                type: Inject,
                args: [NGX_HIGHLIGHT_JS_URL]
            }] }]; }, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
class NgxHighlightJsService {
    /**
     * @param {?} themeService
     * @param {?} scriptService
     */
    constructor(themeService, scriptService) {
        this.themeService = themeService;
        this.scriptService = scriptService;
    }
    /**
     * @return {?}
     */
    get theme() {
        return this.themeService._theme;
    }
    /**
     * @return {?}
     */
    loaded() {
        if (this._loadedPromise) {
            return this._loadedPromise;
        }
        const /** @type {?} */ promises = [this.scriptService.loaded(), this.themeService.initialized()];
        this._loadedPromise = Promise.all(promises)
            .then((results) => {
            this._hljs = results[0];
            return (this._hljs);
        });
        return this._loadedPromise;
    }
    /**
     * @param {?} lang
     * @return {?}
     */
    loadLanguage(lang) {
        return this.scriptService.loadLanguage(lang);
    }
    /**
     * @param {?} name
     * @return {?}
     */
    loadTheme(name) {
        return this.themeService.loadTheme(name);
    }
    /**
     * @param {?} lang
     * @param {?} code
     * @return {?}
     */
    highlight(lang, code) {
        return this.loaded()
            .then(() => {
            return this.loadLanguage(lang);
        })
            .then(() => {
            const /** @type {?} */ hl = this._hljs.highlight(lang, code, true).value;
            return hl;
        });
    }
}
NgxHighlightJsService.ɵfac = function NgxHighlightJsService_Factory(t) { return new (t || NgxHighlightJsService)(ɵngcc0.ɵɵinject(NgxHighlightJsThemeService), ɵngcc0.ɵɵinject(NgxHighlightJsScriptService)); };
NgxHighlightJsService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NgxHighlightJsService, factory: NgxHighlightJsService.ɵfac, providedIn: 'root' });
/** @nocollapse */
NgxHighlightJsService.ctorParameters = () => [
    { type: NgxHighlightJsThemeService },
    { type: NgxHighlightJsScriptService }
];
/** @nocollapse */ NgxHighlightJsService.ngInjectableDef = defineInjectable({ factory: function NgxHighlightJsService_Factory() { return new NgxHighlightJsService(inject(NgxHighlightJsThemeService), inject(NgxHighlightJsScriptService)); }, token: NgxHighlightJsService, providedIn: "root" });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NgxHighlightJsService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: NgxHighlightJsThemeService }, { type: NgxHighlightJsScriptService }]; }, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
class NgxHighlightJsComponent {
    /**
     * @param {?} service
     * @param {?} http
     */
    constructor(service, http) {
        this.service = service;
        this.http = http;
        this.highlightedHTML = '';
        this.error = null;
        this.afterInit = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.onChange();
        this.afterInit = true;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (this.afterInit) {
            this.onChange();
        }
    }
    /**
     * @return {?}
     */
    fetchText() {
        if (!this.url) {
            return Promise.resolve(this.code || '');
        }
        return new Promise((resolve, reject) => {
            this.http.get(this.url, { responseType: 'text' }).subscribe((text) => resolve(text), (err) => reject(err));
        });
    }
    /**
     * @return {?}
     */
    onChange() {
        this.error = null;
        this.isInitializing = true;
        this.fetchText()
            .then((text) => {
            return this.service.highlight(this.lang, text);
        })
            .then((hl) => {
            this.highlightedHTML = hl;
            this.isInitializing = false;
        })
            .catch(e => {
            this.error = e.toString();
            this.isInitializing = false;
        });
    }
}
NgxHighlightJsComponent.ɵfac = function NgxHighlightJsComponent_Factory(t) { return new (t || NgxHighlightJsComponent)(ɵngcc0.ɵɵdirectiveInject(NgxHighlightJsService), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.HttpClient)); };
NgxHighlightJsComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: NgxHighlightJsComponent, selectors: [["ngx-highlight-js"]], inputs: { code: "code", url: "url", lang: "lang" }, exportAs: ["ngxHighlightJs"], features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 2, vars: 2, consts: [[3, "ngClass", "innerHTML"]], template: function NgxHighlightJsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "pre");
        ɵngcc0.ɵɵelement(1, "code", 0);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngClass", "hljs " + ctx.lang)("innerHTML", ctx.highlightedHTML, ɵngcc0.ɵɵsanitizeHtml);
    } }, directives: [ɵngcc2.NgClass], encapsulation: 2 });
/** @nocollapse */
NgxHighlightJsComponent.ctorParameters = () => [
    { type: NgxHighlightJsService },
    { type: HttpClient }
];
NgxHighlightJsComponent.propDecorators = {
    code: [{ type: Input }],
    url: [{ type: Input }],
    lang: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NgxHighlightJsComponent, [{
        type: Component,
        args: [{
                selector: 'ngx-highlight-js',
                exportAs: `ngxHighlightJs`,
                template: `<pre><code
      [ngClass]="'hljs ' + lang"
      [innerHTML]="highlightedHTML"></code></pre>`
            }]
    }], function () { return [{ type: NgxHighlightJsService }, { type: ɵngcc1.HttpClient }]; }, { code: [{
            type: Input
        }], url: [{
            type: Input
        }], lang: [{
            type: Input
        }] }); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
class NgxHighlightJsModule {
    /**
     * @return {?}
     */
    static forRoot() {
        return {
            ngModule: NgxHighlightJsModule,
            providers: [
                NgxHighlightJsThemeService,
                NgxHighlightJsScriptService,
                NgxHighlightJsService,
                { provide: NGX_HIGHLIGHT_JS_URL, useValue: '//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0' },
                { provide: NGX_HIGHLIGHT_JS_DEFAULT_THEME, useValue: 'default' },
            ]
        };
    }
}
NgxHighlightJsModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: NgxHighlightJsModule });
NgxHighlightJsModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function NgxHighlightJsModule_Factory(t) { return new (t || NgxHighlightJsModule)(); }, imports: [[
            CommonModule,
            HttpClientModule
        ]] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(NgxHighlightJsModule, { declarations: function () { return [NgxHighlightJsComponent]; }, imports: function () { return [CommonModule,
        HttpClientModule]; }, exports: function () { return [NgxHighlightJsComponent]; } }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NgxHighlightJsModule, [{
        type: NgModule,
        args: [{
                imports: [
                    CommonModule,
                    HttpClientModule
                ],
                declarations: [NgxHighlightJsComponent],
                exports: [NgxHighlightJsComponent]
            }]
    }], null, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

export { NGX_HIGHLIGHT_JS_URL, NGX_HIGHLIGHT_JS_DEFAULT_THEME, NgxHighlightJsService, NgxHighlightJsModule, NgxHighlightJsScriptService as ɵb, NgxHighlightJsThemeService as ɵa, NgxHighlightJsComponent as ɵc };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm93em9vLW5neC1oaWdobGlnaHQtanMuanMiLCJzb3VyY2VzIjpbIm5nOi9Abm93em9vL25neC1oaWdobGlnaHQtanMvbGliL25neC1oaWdobGlnaHQtanMtb3B0aW9ucy50cyIsIm5nOi9Abm93em9vL25neC1oaWdobGlnaHQtanMvbGliL25neC1oaWdobGlnaHQtanMtdGhlbWUuc2VydmljZS50cyIsIm5nOi9Abm93em9vL25neC1oaWdobGlnaHQtanMvbGliL25neC1oaWdobGlnaHQtanMtc2NyaXB0LnNlcnZpY2UudHMiLCJuZzovQG5vd3pvby9uZ3gtaGlnaGxpZ2h0LWpzL2xpYi9uZ3gtaGlnaGxpZ2h0LWpzLnNlcnZpY2UudHMiLCJuZzovQG5vd3pvby9uZ3gtaGlnaGxpZ2h0LWpzL2xpYi9uZ3gtaGlnaGxpZ2h0LWpzLmNvbXBvbmVudC50cyIsIm5nOi9Abm93em9vL25neC1oaWdobGlnaHQtanMvbGliL25neC1oaWdobGlnaHQtanMubW9kdWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBLHVCQUNhLG9CQUFvQixHQUFHLElBQUksY0FBYyxDQUFTLCtCQUErQixDQUFDLENBQUM7QUFDaEcsdUJBQWEsOEJBQThCLEdBQUcsSUFBSSxjQUFjLENBQVMsb0NBQW9DLENBQUM7Ozs7OztBQ0Y5Rzs7Ozs7SUFjRSxZQUNrRCxhQUFxQixFQUMvQixNQUFjO1FBREosa0JBQWEsR0FBYixhQUFhLENBQVE7UUFDL0IsV0FBTSxHQUFOLE1BQU0sQ0FBUTtzQkFMN0MsU0FBUzttQ0FDbUIsSUFBSTt1QkFDZCxJQUFJO1FBSzdCLElBQUksQ0FBQyxNQUFNLEdBQUcsYUFBYSxDQUFDO0tBQzdCOzs7O0lBRUQsV0FBVztRQUNULElBQUksQ0FBRSxJQUFJLENBQUMsbUJBQW1CLEVBQUU7WUFDOUIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3hEO1FBQ0Qs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UUFBUSxFQUFFLFNBQVMsRUFBQzthQUMvRDtTQUNGLENBQUM7S0FDSDs7Ozs7O0NBQ0Y7bUNBckJBLFFBQVEsU0FBQyxrQkFDUixPQUFPLEVBQUUsc0JBQ1AsWUFBWSxzQkFDWixnQkFBZ0Isa0JBQ2pCLGtCQUNELFlBQVksRUFBRSxDQUFDLHVCQUF1QjtBQUFDLGtCQUN2QyxPQUFPLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQyxlQUNuQzs7Ozs7Ozs7Ozs7MEJBQ0siLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3Rpb25Ub2tlbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuZXhwb3J0IGNvbnN0IE5HWF9ISUdITElHSFRfSlNfVVJMID0gbmV3IEluamVjdGlvblRva2VuPHN0cmluZz4oJ1RoZSBiYXNlIHVybCBmb3IgaGlnaGxpZ2h0LmpzJyk7XG5leHBvcnQgY29uc3QgTkdYX0hJR0hMSUdIVF9KU19ERUZBVUxUX1RIRU1FID0gbmV3IEluamVjdGlvblRva2VuPHN0cmluZz4oJ1RoZSBkZWZhdWx0IHRoZW1lIGZvciBoaWdobGlnaHQuanMnKTtcbiIsImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU2hlZXRsb2FkIH0gZnJvbSAnQG5vd3pvby9zaGVldGxvYWQnO1xuaW1wb3J0IHtcbiAgTkdYX0hJR0hMSUdIVF9KU19ERUZBVUxUX1RIRU1FLFxuICBOR1hfSElHSExJR0hUX0pTX1VSTFxufSBmcm9tICcuL25neC1oaWdobGlnaHQtanMtb3B0aW9ucyc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIE5neEhpZ2hsaWdodEpzVGhlbWVTZXJ2aWNlIHtcbiAgX3RoZW1lID0gJ2RlZmF1bHQnO1xuICBfaW5pdGlhbGl6ZWRQcm9taXNlOiBQcm9taXNlPHZvaWQ+ID0gbnVsbDtcbiAgX2xpbmtFbDogSFRNTExpbmtFbGVtZW50ID0gbnVsbDtcbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChOR1hfSElHSExJR0hUX0pTX0RFRkFVTFRfVEhFTUUpIHByaXZhdGUgX2RlZmF1bHRUaGVtZTogc3RyaW5nLFxuICAgIEBJbmplY3QoTkdYX0hJR0hMSUdIVF9KU19VUkwpIHByaXZhdGUgX2pzVVJMOiBzdHJpbmdcbiAgKSB7XG4gICAgdGhpcy5fdGhlbWUgPSBfZGVmYXVsdFRoZW1lO1xuICB9XG5cbiAgaW5pdGlhbGl6ZWQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCEgdGhpcy5faW5pdGlhbGl6ZWRQcm9taXNlKSB7XG4gICAgICB0aGlzLl9pbml0aWFsaXplZFByb21pc2UgPSB0aGlzLmxvYWRUaGVtZSh0aGlzLl90aGVtZSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9pbml0aWFsaXplZFByb21pc2U7XG4gIH1cblxuICBsb2FkVGhlbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5fanNVUkx9L3N0eWxlcy8ke25hbWV9Lm1pbi5jc3NgO1xuICAgIHJldHVybiBTaGVldGxvYWQubG9hZCh1cmwpXG4gICAgICAudGhlbigobGlua0VsOiBIVE1MTGlua0VsZW1lbnQpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuX2xpbmtFbCkge1xuICAgICAgICAgIHRoaXMuX2xpbmtFbC5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9saW5rRWwgPSBsaW5rRWw7XG4gICAgICAgIHRoaXMuX2xpbmtFbC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgICB9KTtcbiAgfVxuXG4gIGdldCB0aGVtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl90aGVtZTtcbiAgfVxuXG59XG4iLCJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFNjcmlwdGxvYWQgfSBmcm9tICdAbm93em9vL3NoZWV0bG9hZCc7XG5cbmltcG9ydCB7XG4gIE5HWF9ISUdITElHSFRfSlNfVVJMXG59IGZyb20gJy4vbmd4LWhpZ2hsaWdodC1qcy1vcHRpb25zJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgTmd4SGlnaGxpZ2h0SnNTY3JpcHRTZXJ2aWNlIHtcbiAgX2xvYWRlZExhbmd1YWdlczogTWFwPHN0cmluZywgUHJvbWlzZTxhbnk+PjtcbiAgX2hsanM6IGFueSA9IG51bGw7XG4gIF9sb2FkZWRQcm9taXNlOiBQcm9taXNlPGFueT47XG4gIGNvbnN0cnVjdG9yKFxuICAgIEBJbmplY3QoTkdYX0hJR0hMSUdIVF9KU19VUkwpIHByaXZhdGUgX2pzVVJMOiBzdHJpbmdcbiAgKSB7XG4gICAgdGhpcy5fbG9hZGVkTGFuZ3VhZ2VzID0gbmV3IE1hcCgpO1xuICB9XG5cbiAgbG9hZGVkKCk6IFByb21pc2U8YW55PiB7XG4gICAgaWYgKHRoaXMuX2xvYWRlZFByb21pc2UpIHtcbiAgICAgIHJldHVybiB0aGlzLl9sb2FkZWRQcm9taXNlO1xuICAgIH1cbiAgICB0aGlzLl9sb2FkZWRQcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5fanNVUkx9L2hpZ2hsaWdodC5taW4uanNgO1xuICAgICAgU2NyaXB0bG9hZC5sb2FkKHVybClcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5faGxqcyA9IHdpbmRvd1snaGxqcyddO1xuICAgICAgICAgICAgcmVzb2x2ZSh0aGlzLl9obGpzKTtcbiAgICAgICAgICB9LCAxMCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChyZWplY3QpO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzLl9sb2FkZWRQcm9taXNlO1xuICB9XG5cbiAgbG9hZExhbmd1YWdlKGxhbmc6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGxldCBwID0gdGhpcy5fbG9hZGVkTGFuZ3VhZ2VzLmdldChsYW5nKTtcbiAgICBpZiAocCkge1xuICAgICAgcmV0dXJuIHA7XG4gICAgfVxuICAgIGlmICh0aGlzLl9obGpzICYmIHRoaXMuX2hsanMubGlzdExhbmd1YWdlcygpLmluZGV4T2YobGFuZykgPiAtMSkge1xuICAgICAgcCA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgdGhpcy5fbG9hZGVkTGFuZ3VhZ2VzLnNldChsYW5nLCBwKTtcbiAgICAgIHJldHVybiBwO1xuICAgIH1cbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLl9qc1VSTH0vbGFuZ3VhZ2VzLyR7bGFuZ30ubWluLmpzYDtcbiAgICBwID0gdGhpcy5sb2FkZWQoKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICByZXR1cm4gU2NyaXB0bG9hZC5sb2FkKHVybCk7XG4gICAgICB9KTtcbiAgICB0aGlzLl9sb2FkZWRMYW5ndWFnZXMuc2V0KGxhbmcsIHApO1xuICAgIHJldHVybiBwO1xuICB9XG59XG4iLCJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOZ3hIaWdobGlnaHRKc1RoZW1lU2VydmljZSB9IGZyb20gJy4vbmd4LWhpZ2hsaWdodC1qcy10aGVtZS5zZXJ2aWNlJztcbmltcG9ydCB7IE5neEhpZ2hsaWdodEpzU2NyaXB0U2VydmljZSB9IGZyb20gJy4vbmd4LWhpZ2hsaWdodC1qcy1zY3JpcHQuc2VydmljZSc7XG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBOZ3hIaWdobGlnaHRKc1NlcnZpY2Uge1xuICBwcml2YXRlIF9obGpzOiBhbnk7XG4gIHByaXZhdGUgX2xvYWRlZFByb21pc2U6IFByb21pc2U8YW55PjtcblxuXG4gIGdldCB0aGVtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnRoZW1lU2VydmljZS5fdGhlbWU7XG4gIH1cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB0aGVtZVNlcnZpY2U6IE5neEhpZ2hsaWdodEpzVGhlbWVTZXJ2aWNlLFxuICAgIHByaXZhdGUgc2NyaXB0U2VydmljZTogTmd4SGlnaGxpZ2h0SnNTY3JpcHRTZXJ2aWNlXG4gICkgeyB9XG5cbiAgbG9hZGVkKCk6IFByb21pc2U8YW55PiB7XG4gICAgaWYgKHRoaXMuX2xvYWRlZFByb21pc2UpIHtcbiAgICAgIHJldHVybiB0aGlzLl9sb2FkZWRQcm9taXNlO1xuICAgIH1cbiAgICBjb25zdCBwcm9taXNlcyA9IFt0aGlzLnNjcmlwdFNlcnZpY2UubG9hZGVkKCksIHRoaXMudGhlbWVTZXJ2aWNlLmluaXRpYWxpemVkKCldO1xuICAgIHRoaXMuX2xvYWRlZFByb21pc2UgPSBQcm9taXNlLmFsbChwcm9taXNlcylcbiAgICAgIC50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgICAgIHRoaXMuX2hsanMgPSByZXN1bHRzWzBdO1xuICAgICAgICByZXR1cm4gKHRoaXMuX2hsanMpO1xuICAgICAgfSk7XG4gICAgcmV0dXJuIHRoaXMuX2xvYWRlZFByb21pc2U7XG4gIH1cblxuICBsb2FkTGFuZ3VhZ2UobGFuZzogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMuc2NyaXB0U2VydmljZS5sb2FkTGFuZ3VhZ2UobGFuZyk7XG4gIH1cblxuICBsb2FkVGhlbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMudGhlbWVTZXJ2aWNlLmxvYWRUaGVtZShuYW1lKTtcbiAgfVxuXG4gIGhpZ2hsaWdodChsYW5nOiBzdHJpbmcsIGNvZGU6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMubG9hZGVkKClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZExhbmd1YWdlKGxhbmcpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgY29uc3QgaGwgPSB0aGlzLl9obGpzLmhpZ2hsaWdodChsYW5nLCBjb2RlLCB0cnVlKS52YWx1ZTtcbiAgICAgICAgcmV0dXJuIGhsO1xuICAgICAgfSk7XG4gIH1cblxufVxuIiwiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE9uQ2hhbmdlcywgSW5wdXQsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5neEhpZ2hsaWdodEpzU2VydmljZSB9IGZyb20gJy4vbmd4LWhpZ2hsaWdodC1qcy5zZXJ2aWNlJztcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25neC1oaWdobGlnaHQtanMnLFxuICBleHBvcnRBczogYG5neEhpZ2hsaWdodEpzYCxcbiAgdGVtcGxhdGU6IGA8cHJlPjxjb2RlXG4gICAgICBbbmdDbGFzc109XCInaGxqcyAnICsgbGFuZ1wiXG4gICAgICBbaW5uZXJIVE1MXT1cImhpZ2hsaWdodGVkSFRNTFwiPjwvY29kZT48L3ByZT5gLFxufSlcbmV4cG9ydCBjbGFzcyBOZ3hIaWdobGlnaHRKc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcblxuICBASW5wdXQoKSBjb2RlOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHVybDogc3RyaW5nO1xuICBASW5wdXQoKSBsYW5nOiBzdHJpbmc7XG5cbiAgaGlnaGxpZ2h0ZWRIVE1MID0gJyc7XG4gIGVycm9yOiBzdHJpbmcgPSBudWxsO1xuICBpc0luaXRpYWxpemluZzogYm9vbGVhbjtcblxuICBwcml2YXRlIGFmdGVySW5pdCA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgc2VydmljZTogTmd4SGlnaGxpZ2h0SnNTZXJ2aWNlLFxuICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcbiAgKSB7IH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLm9uQ2hhbmdlKCk7XG4gICAgdGhpcy5hZnRlckluaXQgPSB0cnVlO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGlmICh0aGlzLmFmdGVySW5pdCkge1xuICAgICAgdGhpcy5vbkNoYW5nZSgpO1xuICAgIH1cbiAgfVxuXG5cbiAgZmV0Y2hUZXh0KCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKCEgdGhpcy51cmwpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5jb2RlIHx8ICcnKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuaHR0cC5nZXQodGhpcy51cmwsIHtyZXNwb25zZVR5cGU6ICd0ZXh0J30pLnN1YnNjcmliZShcbiAgICAgICAgKHRleHQpID0+IHJlc29sdmUodGV4dCksIChlcnIpID0+IHJlamVjdChlcnIpXG4gICAgICApO1xuICAgIH0pO1xuXG4gIH1cblxuICBvbkNoYW5nZSgpIHtcbiAgICB0aGlzLmVycm9yID0gbnVsbDtcbiAgICB0aGlzLmlzSW5pdGlhbGl6aW5nID0gdHJ1ZTtcbiAgICB0aGlzLmZldGNoVGV4dCgpXG4gICAgICAudGhlbigodGV4dDogc3RyaW5nKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2UuaGlnaGxpZ2h0KHRoaXMubGFuZywgdGV4dCk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKGhsKSA9PiB7XG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0ZWRIVE1MID0gaGw7XG4gICAgICAgIHRoaXMuaXNJbml0aWFsaXppbmcgPSBmYWxzZTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZSA9PiB7XG4gICAgICAgIHRoaXMuZXJyb3IgPSBlLnRvU3RyaW5nKCk7XG4gICAgICAgIHRoaXMuaXNJbml0aWFsaXppbmcgPSBmYWxzZTtcbiAgICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgeyBOZ01vZHVsZSwgTW9kdWxlV2l0aFByb3ZpZGVycywgSW5qZWN0aW9uVG9rZW4gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBIdHRwQ2xpZW50TW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgTmd4SGlnaGxpZ2h0SnNUaGVtZVNlcnZpY2UgfSBmcm9tICcuL25neC1oaWdobGlnaHQtanMtdGhlbWUuc2VydmljZSc7XG5pbXBvcnQgeyBOZ3hIaWdobGlnaHRKc1NjcmlwdFNlcnZpY2UgfSBmcm9tICcuL25neC1oaWdobGlnaHQtanMtc2NyaXB0LnNlcnZpY2UnO1xuaW1wb3J0IHsgTmd4SGlnaGxpZ2h0SnNTZXJ2aWNlIH0gZnJvbSAnLi9uZ3gtaGlnaGxpZ2h0LWpzLnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgTkdYX0hJR0hMSUdIVF9KU19ERUZBVUxUX1RIRU1FLFxuICBOR1hfSElHSExJR0hUX0pTX1VSTFxufSBmcm9tICcuL25neC1oaWdobGlnaHQtanMtb3B0aW9ucyc7XG5pbXBvcnQgeyBOZ3hIaWdobGlnaHRKc0NvbXBvbmVudCB9IGZyb20gJy4vbmd4LWhpZ2hsaWdodC1qcy5jb21wb25lbnQnO1xuXG5cblxuQE5nTW9kdWxlKHtcbiAgaW1wb3J0czogW1xuICAgIENvbW1vbk1vZHVsZSxcbiAgICBIdHRwQ2xpZW50TW9kdWxlXG4gIF0sXG4gIGRlY2xhcmF0aW9uczogW05neEhpZ2hsaWdodEpzQ29tcG9uZW50XSxcbiAgZXhwb3J0czogW05neEhpZ2hsaWdodEpzQ29tcG9uZW50XSxcbn0pXG5leHBvcnQgY2xhc3MgTmd4SGlnaGxpZ2h0SnNNb2R1bGUge1xuICBzdGF0aWMgZm9yUm9vdCgpOiBNb2R1bGVXaXRoUHJvdmlkZXJzIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmdNb2R1bGU6IE5neEhpZ2hsaWdodEpzTW9kdWxlLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIE5neEhpZ2hsaWdodEpzVGhlbWVTZXJ2aWNlLFxuICAgICAgICBOZ3hIaWdobGlnaHRKc1NjcmlwdFNlcnZpY2UsXG4gICAgICAgIE5neEhpZ2hsaWdodEpzU2VydmljZSxcbiAgICAgICAge3Byb3ZpZGU6IE5HWF9ISUdITElHSFRfSlNfVVJMLCB1c2VWYWx1ZTogJy8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2hpZ2hsaWdodC5qcy85LjEyLjAnfSxcbiAgICAgICAge3Byb3ZpZGU6IE5HWF9ISUdITElHSFRfSlNfREVGQVVMVF9USEVNRSwgdXNlVmFsdWU6ICdkZWZhdWx0J30sXG4gICAgICBdXG4gICAgfTtcbiAgfVxufVxuIl19